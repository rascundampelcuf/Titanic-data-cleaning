---
title: 'Pràctica 2: Neteja i anàlisi de les dades'
author: "Mireia Olivella i Gabriel Izquierdo"
date: '`r format(Sys.Date(),"%e de maig de %Y")`'
output:
  pdf_document:
    number_sections: yes
    toc: yes
    toc_depth: 3
header-includes: \renewcommand{\contentsname}{Índex}
urlcolor: blue
---

```{r, include=FALSE}
library(knitr)
library(dplyr)
library(modeest)
library(normtest)
library(nortest)
library(car)
if(!require(ggplot2)){
  install.packages('ggplot2', repos='http://cran.us.r-project.org')
  library(ggplot2)
}
if(!require(grid)){
  install.packages('grid', repos='http://cran.us.r-project.org')
  library(grid)
}
if(!require(gridExtra)){
  install.packages('gridExtra', repos='http://cran.us.r-project.org')
  library(gridExtra)
}
if(!require(dummies)){
  install.packages("dummies")
  library(dummies)
}
if(!require(e1071)){
  install.packages("e1071")
  library(e1071)
}
if(!require(ROCR)){
  install.packages("ROCR")
  library(ROCR)
}
if(!require(caret)){
  install.packages("caret")
  library(caret)
}
if(!require(arules)){
  install.packages("arules")
  library(arules)
}
if(!require(corrplot)){
  install.packages("corrplot")
  library(corrplot)
}
if(!require(Hmisc)){
  install.packages("Hmisc")
  library(Hmisc)
}
```

\pagebreak

# Descripció del dataset

El conjunt de dades escollit recull informació dels passatgers del titanic, en el que es pot analitzar la superviència i les característiques d'aquests. 
Aquest conjunt de dades s'ha obtingut de la web de Kaggle. S'hi pot accedir a partir de l'enllaç que es mostra a continuació:

https://www.kaggle.com/c/titanic

El conjunt de dades utilitzat està format per 1309 registres amb 12 atributs dividit en 2 fitxers CSV, un de *train* i un de *test*, ja que aquest conjunt de dades està preparat per ser utilitzat per tasques de predicció. Els atributs d'aquest conjunt de dades són els següents:

* **passengerId**: identificador dels registres del dataset.
* **survived**: indica si el passatger va sobreviure (0=No, 1=Sí).
* **pclass**: indica la classe en la que viatjava el passatger (1=1a, 2=2a, 3=3a).
* **name**: nom del passatger.
* **sex**: gènere del passatger (*female* o *male*).
* **age**: edat del passatger.
* **sibsp**: número de germans i cònjugues a bord del Titànic.
* **parch**: número de pares i fills a bord del Titànic.
* **ticket**: número del bitllet
* **fare**: preu de compra del bitllet.
* **cabin**: número de cabina on viatjava el passatger.
* **embarked**: port on va embarcar el passatger (C=Cherbourg, Q=Queenstown, S=Southampton).

Aquest conjunt de dades és important perquè representa les dades d'un dels naufragis més infames de la història. A més, ens permet abastir tots els aspectes importants a tenir en compte a l'hora de dur a terme aquesta pràctica.

La pregunta que intenta respondre és la de quins són els factors que van afavorir a un passatger sobreviure al naufragi. Si bé hi havia un element de sort en la supervivència dels passatgers, sembla que alguns grups de persones tenien més probabilitats de sobreviure que d'altres.

# Neteja de les dades
Abans de començar amb la neteja de les dades, procedim a realitzar les lectures dels fitxers en format CSV en el que es troben. El procediment és el de carregar la informació dels tres fitxers i unir-les posteriorment.

En la secció anterior s'ha parlat de dos fitxers de tipus CSV, i ara se n'ha parlat de tres. Això es deu a que al fitxer `test.csv` li falta un atribut respecte al fitxer `train.csv`, que és el de `Survived`. La informació referent a la supervivència dels passatgers del fitxer `test.csv` es troba en un altre fitxer anomenat `gender_submission.csv` que té només dues columnes: `PassengerId` i `Survived`.

El primer que fem és carregar la informació de tots els fitxers CSV. Després fem un *merge* de les dades de `test.csv` i `gender_submission.csv` utilitzant la funció `merge` amb l'atribut `PassengerId` com a clau comuna entre les dues taules. Per acabar s'uneixen totes les dades de *train* i *test* en un sol *dataframe* utilitzant la funció `rbind`.

```{r}
# Lectura de les dades
titanic_train <- read.csv("../data/train.csv")
titanic_test <- read.csv("../data/test.csv")
titanic_gender_submission <- read.csv("../data/gender_submission.csv")
titanic_test <- merge(titanic_test, titanic_gender_submission, by="PassengerId")
titanic_data <- rbind(titanic_train, titanic_test)
head(titanic_data)
```

```{r}
# Tipus de dada assignat a cada camp
sapply(titanic_data, function(x) class(x))
```

Podem observar que els tipus de dades assignats automàticament per R a les nostres variables no s'acaben de correspondre amb el domini d'aquestes. Aquest és el cas de l'atribut `Survived`. R detecta que es tracta d'un *integer*, quan en realitat es tracta d'un *factor*, pel que procedim a assignar-li el tipus que nosaltres volem.

```{r}
# Canvi del tipus del camp 'Survived'
titanic_data$Survived <- factor(titanic_data$Survived)
```


## Selecció de les dades d'interès
Totes les variables que tenim en el dataset fan referència a característiques dels passatgers del titanic.
Tot i això, podem precindir de les columnes *PassengerId*, *Name*, *Ticket* i *Cabin* ja que no aporten informació rellevant de cara a la pregunta que respon aquest conjunt de dades.

```{r}
# Eliminació de les columes 'PassengerId', 'Name', 'Ticket' i 'Cabin'
titanic_data <- select(titanic_data, -c(PassengerId, Name, Ticket, Cabin))
summary(titanic_data)
```

## Dades amb elements buits (valors perduts)
Aquest conjunt de dades conté dades amb elements buits representats de dues maneres diferents: amb el valor NA (*Not Available*) i amb un espai en blanc, pel que es procedeix a comprovar quins camps contenen elements buits i en quina quantitat.

```{r}
# Número de valors perduts per camp
colSums(is.na(titanic_data))
colSums(titanic_data == "")
```

Com es pot observar tenim 2 valors en blanc a la variable *Embarked*, 1 valor NA a *Fare* i 263 valors NA a *Age*.

Primer de tot tractarem els valors en blanc de la variable *Embarked*. Ens basarem en utilitzar una mesura de tendència central i, al tractar-se d'una variable categòrica, utilitzarem la **moda**.

```{r}
# Consulta de la moda de la variable 'Embarked'
mlv(titanic_data$Embarked, method = "mfv")
```

Com es pot observar, al ser *S* la moda prenem aquest valor per omplir als valors buits de la variable.

```{r}
# Imputació dels valors buits de la variable 'Embarked'
titanic_data$Embarked[titanic_data$Embarked == ""] = "S"
```

Per tractar el valor perdut a la variable *Fare* s'utilitzarà la **mitjana**.
```{r}
# Imputació dels valors buits de la variable 'Fare'
titanic_data[is.na(titanic_data$Fare),]$Fare <- mean(titanic_data$Fare, na.rm = TRUE)
```

Per acabar, per tractar els valors perduts de la variable *Age* s'utilitzarà la **mitjana**. Per dur a terme la obtenció d'aquesta mitjana, enlloc d'obtenir la mitjana de l'atribut *Age* sencer, tindrem en compte el gènere (*Sex*) i la classe en la que viatjava (*Pclass*).
A la gràfica següent es pot observar la relació entre els atributs *Age* i *Pclass* per dones i per homes.

```{r}
# Visualitzem la relació entre les variables 'Age' i 'Pclass'
par(mfrow = c(1,2))
female_people = titanic_data[titanic_data$Sex == "male",]
male_people = titanic_data[titanic_data$Sex == "female",]
boxplot(female_people$Age~female_people$Pclass, main = "Pclass by age (female)",
        xlab = "Pclass", ylab = "Age")
boxplot(male_people$Age~male_people$Pclass, main = "Pclass by age (male)",
        xlab = "Pclass", ylab = "Age")
```

Per tractar els valors perduts tindrem en compte la informació observada a la gràfica anterior. Per realitzar aquesta tasca s'ha creat una funció `AgeMean` per obtenir la mitjana d'edats de les dones i dels homes segons la classe, i després s'ha creat una altra funció assignar als passatgers que tenen l'edat en blanc la mitjana corresponent al seu gènere i a la classe en la que viatjava.

```{r}
# Funció per obtenir el camp 'Mean' del resultat de la funció 'summary'
AgeMean <- function(age) {
  round(summary(age)['Mean'])
}

female_mean_ages = tapply(female_people$Age, female_people$Pclass, AgeMean)
male_mean_ages = tapply(male_people$Age, male_people$Pclass, AgeMean)

# Funció per obtenir un valor de mitjana d'edat segons els camps 'Sex' i 'Pclass'
AgeImpute <- function(row) {
  sex <- row['Sex']
  age <- row['Age']
  pclass <- row['Pclass']
  value <- age
  if (is.na(age)) {
    if (sex == "female") {
      value <- female_mean_ages[pclass]
    } else {
      value <- male_mean_ages[pclass]
    }
  }
  return(as.numeric(value))
}

titanic_data$Age <- apply(titanic_data[, c("Sex", "Age", "Pclass")], 1, AgeImpute)
```

## Identificació de valors extrems
Els valors extrems o outliers són registres que destacant per ser molt distants al valor central del conjunt. Generalment es considera un outlier quan el seu valor es troba allunyat 3 desviacions estàndars respecte la mitjana, un instrument gràfic que ens permet visualitzar ràpidament aquests valors són els diagrames de caixes. Una altre forma de detectar-los a R, es mitjançant la funció boxplot.stats()

```{r}
fare.bp<-boxplot(titanic_data$Fare, main="Fare", col="darkgreen")
boxplot.stats(titanic_data$Fare)$out

Age.bp<-boxplot(titanic_data$Age, main="Age", col="darkgreen")
boxplot.stats(titanic_data$Age)$out
```
Si ens fixem en els valors extrems resultants, en el cas d'Age, són valors que poden donar-se perfectament, ja que podem tenir persones de 80 anys com a passatgers.
En el cas de Fare, són valors que també es poden haver donat, ja que el preu que hagi pugut pagar cada passatger pot tenir una gran oscil.lació, i es poden donar valors de 0 a 500 perfectament.
Es per això, que tot i haver-los detectat, hem decidit no tractar-los de manera diferent a com han estat recollits.


# Anàlisi de les dades
## Comprovació de la normalitat i homogeneïtat de la variància
Per comprobar si les variables Age i Fare segueixen una distribució normal, podem tenir una aproximació amb la funció qqnorm, la qual comparara els quartils de la distribució observada amb els quartils teòrics d'una distribució normal, com més s'aproximen a les dades d'una normal, més alineats es trobaran els punts al voltant de la recta.
```{r}
#Representació de la distribució de la variable Fare mitjançant un histograma: 
hist(x=titanic_data$Fare, main="Histograma Fare", xlab="Fare", ylab="Frecuencia", col = "darkgreen", ylim=c(0,1200), xlim = c(0,600))
qqnorm(titanic_data$Fare) 
qqline(titanic_data$Fare, col="red")
ggplot(titanic_data,aes(Fare)) + geom_density(size=1, alpha= 0.6)+ ylab("DENSITAT")
```
Mitjançant els gràfics anteriors, podem veure que hi ha força desviaciço en alguns trams, i per tant, possibles evidències de que no segueix una distribució normal. Ho contrasterem mitjançant el Test Lilliefors (asumeix mediana i variança poblacionals desconegudes)
  *Hipòtesis nul.la: les dades procedeixen d'una distribució normal
  *Hipòtesis alterantiva: no procedeixen d'una distribució normal. 

```{r}
#TEST Lilliefors
lillie.test(x=titanic_data$Fare)
```
Rebutjem la hipòtesis nul.la, la diferència és estadísticament significativa, és a dir, amb un 95% de confiança podem dir que la variable Fare no segueix una distribució normal.
Si repetim el mateix procediment per la variable Age: 
```{r}
#Representació de la distribució de la variable Fare mitjançant un histograma: 
hist(x=titanic_data$Age, main="Histograma Age", xlab="Age", ylab="Frecuencia", col = "darksalmon", ylim=c(0,350), xlim = c(0,100))

qqnorm(titanic_data$Age) 
qqline(titanic_data$Age, col="red")
ggplot(titanic_data,aes(Age)) + geom_density(size=1, alpha= 0.6)+ ylab("DENSITAT")

lillie.test(x=titanic_data$Age)
```
Podem veure novament, com la variable edat per un nivell de confiança del 95% rebutjem la hipòtesis nul.la, i per tant, no podem acceptar que la variable segueixi una distribució normal.

```{r}
pairs(titanic_data[, c(4,7)])
```

#Comprovació de la HOMOGENEITAT DE LA VARIANCIA 
Finalment comprovarem l'homoscedasticitat de les dades, és a dir, la igualtat de variàncies per Fare i Age.
Ja que no tenim seguretat que provinguin d'una població normal, hem utilitzat el test de Levene amb la mediana com a mesura de centralitat, juntament amb el test no paramètric  Fligner-Killeen que també es basa en la mediana. 
  *Hipòtesis nul.la: la variança és constant.
  *Hipòtesis alterantiva: la variança no és constant. 

```{r}
aggregate(Fare~Survived, data = titanic_data, FUN = var)
aggregate(Age~Survived, data = titanic_data, FUN = var)

#Levene TEST
levene <- filter(.data = titanic_data, Survived %in% c("0", "1"))
leveneTest(y = levene$Fare, group = levene$Survived, center = "median")
leveneTest(y = levene$Age, group = levene$Survived, center = "median")

#Test Fligner-Killeen
fligner.test(Fare ~ Survived, data=titanic_data)
fligner.test(Age ~ Survived, data=titanic_data)

```
En els dos tests realitzats, podem veure com tan la variable Fare com Age, es rebutja la hipòtesis nula, és a dir, amb un nivell de confiança del 95%, podem concloure que en ambdos grups la variança no és constant. 


## Aplicació de proves estadístiques
### Contrast d'hipòtesis
Ens interessa descriure la relació entre la supervivència i les variables edat, classe i gènere. 
Per a això, en primer lloc hem dut a terme un gràfic mitjançant diagrames de barres amb la quantitat de morts i supervivents segons la classe en la que viatjaven, l'edat o el gènere.
```{r}
plotbyClass<-ggplot(titanic_data,aes(Pclass,fill=Survived))+geom_bar() +labs(x="Class", y="Passengers")+ guides(fill=guide_legend(title=""))+ scale_fill_manual(values=c("darksalmon","darkseagreen4"))+ggtitle("Survived by Class")
plotbyAge<-ggplot(titanic_data,aes(Age,fill=Survived))+geom_bar() +labs(x="Age", y="Passengers")+ guides(fill=guide_legend(title=""))+ scale_fill_manual(values=c("darksalmon","darkseagreen4"))+ggtitle("Survived by Age")
plotbySex<-ggplot(titanic_data,aes(Sex,fill=Survived))+geom_bar() +labs(x="Sex", y="Passengers")+ guides(fill=guide_legend(title=""))+ scale_fill_manual(values=c("darksalmon","darkseagreen4"))+ggtitle("Survived by Sex")
grid.arrange(plotbyClass,plotbyAge,plotbySex,ncol=2)
```
CRITERIS D'ÈXIT:
1. Van sobreviure més del 50% dels passatgers? Existeix diferència significativa per un nivell de significació del 5%?
Per poder contrastar la hipòtesis, utilitzarem el test binominal exacte. 
H0: la proporció és major del 50%. 
H1: la proporció no és major. 
```{r}
tableSurvived<-table(titanic_data$Survived)
prop.table(table(titanic_data$Survived))
binom.test(x = c(494, 815), alternative = "less", conf.level = 0.95)
```
Amb un nivell de confiança del 95% podem concloure que no va sobreviure més del 50% dels passatgers. 

2. Hi ha diferència significativa entre la proporció d'homes i dones que van sobreviure?
H0: les dues variables són independents. 
H1: les dues variables no són independents. 
Per esbrinar si hi ha diferència, hem executat el test de fisher, el qual ens permet estudiar si existeix asociació entre dues variables qualitatives.
```{r}
table_Sex<-table(titanic_data$Sex, titanic_data$Survived)
prop.table(table(titanic_data$Sex, titanic_data$Survived), margin=1)
fisher.test(table_Sex, alternative = "two.sided")

#Si fem el test X^2 també és significatiu.
chisq.test(x = table_Sex)
chisq.test(x = table_Sex)$residuals
```
Amb un 95% de confiança podem rebutjar el test, i per tant, afirmar que les dues variables estàn relacionades. Concretament, s'esperava un 11.7% més d'homes que sobrevisques i un -15.8% de dones.

3. Hi ha diferències en la supervivencia segons la classe en la que viatjaven?
H0: les dues variables són independents. 
H1: les dues variables no són independents. 
```{r}
table_Class<-table(titanic_data$Pclass, titanic_data$Survived)
prop.table(table(titanic_data$Pclass, titanic_data$Survived), margin=1)
fisher.test(table_Class, alternative = "two.sided")
#Si fem el test X^2 també és significatiu.
chisq.test(x = table_Class)
chisq.test(x = table_Class)$residuals
```
Podem afirmar novament amb un 95% de confiança que hi ha relació entre ambdues variables, on s'esperava un 4.7% més de supervivents de la classe 3, en canvi de la classe 1 s'esperava un 5.8% menys. 


A continuació discretitzarem la variable edat. El nombre d'intervals escollits=3, utilitzarem el mètode d'igual freqüència per tal de mantenir sempre la mateixa freqüència. 
```{r}
dis1<-table(discretize(x=titanic_data$Age, method = "frequency", breaks =4, include.lowest = TRUE))
dis1
titanic_data$AgeD[titanic_data$Age <21] <- "Menors de 21 anys"
titanic_data$AgeD[titanic_data$Age >= 21 & titanic_data$Age < 28] <- "Entre 21 i 28 anys"
titanic_data$AgeD[titanic_data$Age >= 28 & titanic_data$Age < 39] <- "Entre 28 i 39 anys"
titanic_data$AgeD[titanic_data$Age>= 39] <- "Majors de 39"
```

Tot seguit fem de la nova variable un factor
```{r}
titanic_data$AgeD <-
  factor(
    titanic_data$AgeD,
    ordered = FALSE,
    levels = c(
      "Menors de 21 anys",
      "Entre 21 i 28 anys",
      "Entre 28 i 39 anys",
      "Majors de 39"
    )
  )
summary(titanic_data$AgeD)
```

4. Hi ha diferències en la supervivència segons l'edat?
H0: les dues variables són independents. 
H1: les dues variables no són independents. 
```{r}
table_AgeD<-table(titanic_data$AgeD, titanic_data$Survived)
prop.table(table(titanic_data$AgeD, titanic_data$Survived), margin=1)

fisher.test(table_AgeD, alternative = "two.sided")
#Si fem el test X^2 també és significatiu.
chisq.test(x = table_AgeD)
chisq.test(x = table_AgeD)$residuals
chisq.test(x = table_AgeD)$stdres
```
Podem afirmar novament amb un 95% de confiança que hi ha relació entre ambdues variables.S'esperava un 2,3% més de supervivents en la franja d'edat 21-28 anys, en canvi, s'esperava un 2% menys en la de menors de 21.

Finalment, ens interessava conèixer si la probabilitat de sobreviure tenia alguna relació amb el tamany de la família?
En primer lloc, el que hem fet es crear una nova variable, anomenada FamilySize, que és la suma de SibSp i Parch. On a més a més, hem analitzat, si tenía valors extrems, seguia una distribució normal i si la variança era constant entre els diferents grups.
```{r}
#Creació nova variable: 
titanic_data$FamilySize <- titanic_data$SibSp + titanic_data$Parch +1;
hist(titanic_data$FamilySize)
boxplot.stats(titanic_data$FamilySize)$out
fligner.test(Age ~ Survived, data=titanic_data)
lillie.test(x=titanic_data$FamilySize)
```
Podem veure, que les famílies més grans comptant, pares, fills, germans i parelles és de 11, número que hem donat per vàlid. Mitjançant els diferents test, veiem però que no segueix una distribució normal, com tampoc presenta una variança constant. 
El que farem a continuació serà discretitzar la variable en 3 grups:
```{r}
summary(titanic_data$FamilySize)
#Farem serà discretitzar també la variable Família Size. 
titanic_data$FamilySizeD[titanic_data$FamilySize <2] <- "Adult sol"
titanic_data$FamilySizeD[titanic_data$FamilySize >= 2 & titanic_data$FamilySize < 5] <- "Famílies de dos a 4 membres"
titanic_data$FamilySizeD[titanic_data$FamilySize>=5] <- "Famílies amb més de 4 membres"
```
Tot seguit fem de la nova variable un factor
```{r}
titanic_data$FamilySizeD<-
  factor(
    titanic_data$FamilySizeD,
    ordered = FALSE,
    levels = c(
      "Adult sol",
      "Famílies de dos a 4 membres",
      "Famílies amb més de 4 membres"
    )
  )

summary(titanic_data$FamilySizeD)
```
*H0:Les variables són independents, és a dir, el fet de sobreviure no varia segons el tamany de la unitat familiar. 
*H1: Les variables són dependents.
```{r}
table_Family<-table(titanic_data$FamilySizeD, titanic_data$Survived)
prop.table(table(titanic_data$FamilySizeD, titanic_data$Survived), margin=1)
fisher.test(table_Family, alternative = "two.sided")
#Si fem el test X^2 també és significatiu.
chisq.test(x = table_Family)
chisq.test(x = table_Family)$residuals
chisq.test(x = table_Family)$stdres
```
Podem veure amb un nivell de significació del 5%, com el tamany de la unita familiar també va influir, van sobreviure un 9.7% més de famílies de 2-4 membres del que s'esperava, per contra, s'esperava que un 7.8% més d'adults sols sobrevisques.

Mitjançant els gràfics de barres, les taules de contingencia i els tests realitzats podem concloure: 
**La proporció d'homes i dones que van sobreviure és força diferent, homes: 109, dones: 385, si ens fixem en el % respecte el seu gènere, en les dones és del 83% mentre que pels homes és del 23%.
**Referent a la classe en la que viatjaven, si ens fixem en el gràfic, el nombre de personas que més van sobreviure són els que viatjaven en 3 classe, cal dir, però, que el nombre de passatgers d'aquesta classe és molt major. Si ens fixem en el % dins de cada classe, són els de primera classe els que tenen una ràtio més alta de supervivència.
**Cal destacar també que la proporció d'adults sols és més del 50%, i que la franja on hi trobem més viatjants és la franja d'edat entre 21 i 28 anys.
**Després de realitzar els 4 test, podem veure que les diferències són significatives, i que tan l'edat, la classe en la que viatjaven, el gènere com el tamany de la unitat familiar van ser significatius per la superviència.

```{r}
par(mfrow=c(2,2))
plot(table_Class, col = c("darksalmon","darkseagreen4"), main = "Survived vs. Class")
plot(table_Sex, col = c("darksalmon","darkseagreen4"), main = "Survived vs. Sex")
plot(table_AgeD, col = c("darksalmon","darkseagreen4"), main = "Survived vs. Age")
plot(table_Family, col = c("darksalmon","darkseagreen4"), main = "Survived vs. Family Size")
```

### Matriu de correlació
A continuació podem plasmar la idea anterior gràficament, calculant prèviament la matriu de correlació i guardant-la en un objecte.

```{r}
# Creació de la matriu de correlació
corr_data <- titanic_data[, c("Age", "SibSp", "Parch", "Fare")]
M <- cor(corr_data)
par(mfrow = c(1,2))
corrplot(M, method = "color", type = "upper",
         addCoef.col = "white", number.cex = 0.7,
         tl.col="black", tl.srt=35, tl.cex = 0.7,
         order = "hclust")
corrplot.mixed(M)
```

Però no podem dir si són significativament diferent de 0, és a dir, no tenim evidencies estadístiques. Per saber-ho cal dur a terme una prova de significació. Amb la següent instrucció podem veure la matriu anterior i els p-value, on en la majoria dels casos hi ha correlació, els p-value són especialment petits. 

```{r}
rcorr(as.matrix(corr_data))
```

En tots els casos el p-value es (=0) molt petit, és a dir, que és estadísticament significatiu.
Destaquen les relacions entre el preu del bitllet i l'edat, i entre el preu del bitllet i la mida de la família. En aquestes relacions la correlació és positiva, de manera que a major edat major ha sigut el preu del bitllet, i el mateix passa amb la mida de la família i el preu del bitllet. 


### Regressió logística
Volem predir el fet de sobreviure o no, de manera que ens trobem amb una variable discreta, concretament binaria (0,1). Si utilitzéssim un model lineal per predir un grup binàri estariem obtenint un model erroni.


```{r}
# Divisió del conjunt de dades en dos subconjunts, un de train i l'altre de test
train <- titanic_data[1:667,]
test <- titanic_data[668:889,]

# Creació del model de predicció
model <- glm(Survived ~., family = binomial(link = 'logit'), data = train)
summary(model)

# Predicció de les dades
result <- predict(model, newdata = test, type = 'response')
result <- ifelse(result > 0.5,1,0)
fitted.probabilities <- predict(model, newdata = test, type = 'response')
fitted.results <- ifelse(fitted.probabilities > 0.5, 1, 0)

# Matriu de confusió
confusionMatrix(table(fitted.results, test$Survived))
```

Mitjançant els resultats del model podem veure com el fet de pertanyer a la clase 2 o 3 està relacionat amb el fet de sobreviure, com també el genère, on el fet de ser home té un efecte negatiu.

L'edat també té un efecte negatiu en la supervivencia: a major edat menor probabilitat de sobreviure.

Mitjançant l'intercept, podem veure el que hem anat confirmant amb els test d'independència i els gràfics, i és que el fet de ser dona i viatjar a la classe 1 té una major probabilitat de supervivència.

A través de la matriu de confusió es pot veure com el model té un 82% de precisió en la predicció.


# Representació dels resultats

# Resolució del problema

# Recursos
1. Subirats Maté, L., Pérez Trenanz, D. O., & Calvo González, M. (2019). Introducció a la neteja i anàlisi de dades. UOC.
2. Amat Rodrigo, J. (2016). RPubs - Análisis de Normalidad: gráficos y contrastes de hipótesis. https://rpubs.com/Joaquin_AR/218465
3. Homogeneity of variance. http://www.cookbook-r.com/Statistical_analysis/Homogeneity_of_variance/
4. aggregate function | R Documentation. https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/aggregate
5. Shirokanova, A., & Volchenko, O. (2019). RPubs - Chi squared. https://rpubs.com/ovolchenko/chisq2
6. fisher.test function | R Documentation. https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/fisher.test
7. Amat Rodrigo, J. (2016). RPubs - Test exacto de Fisher, chi-cuadrado de Pearson, McNemar y Q-Cochran. https://rpubs.com/Joaquin_AR/220579
8. Ramos Lorenzo, C. (2019). RPubs - Logistic Regression. https://rpubs.com/MrCristianrl/500969

